<!doctype html><html lang=en-us>
<head><meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="picoCTF writeup by Wakeful Cloud"><title>Web Gauntlet 2</title>
<link rel=canonical href=https://bmhstsa.com/post/web-gauntlet-2/>
<link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Web Gauntlet 2">
<meta property="og:description" content="picoCTF writeup by Wakeful Cloud">
<meta property="og:url" content="https://bmhstsa.com/post/web-gauntlet-2/">
<meta property="og:site_name" content="BMHS TSA">
<meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="Web Exploitation"><meta property="article:tag" content="Injection Vulnerability"><meta property="article:tag" content="Wakeful Cloud"><meta property="article:published_time" content="2021-03-30T23:26:46-06:00"><meta property="article:modified_time" content="2021-03-30T23:26:46-06:00">
<meta name=twitter:title content="Web Gauntlet 2">
<meta name=twitter:description content="picoCTF writeup by Wakeful Cloud">
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-193505887-1','auto'),ga('send','pageview'))</script>
<script async src=https://www.google-analytics.com/analytics.js></script>
</head>
<body>
<script>(function(){const a='StackColorScheme';localStorage.getItem(a)||localStorage.setItem(a,"auto")})()</script><script>(function(){const b='StackColorScheme',a=localStorage.getItem(b),c=window.matchMedia('(prefers-color-scheme: dark)').matches===!0;a=='dark'||a==='auto'&&c?document.body.dataset.scheme='dark':document.body.dataset.scheme='light'})()</script><div class="container main-container flex on-phone--column extended article-page with-toolbar">
<aside class="sidebar left-sidebar sticky">
<button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box>
<span class=hamburger-inner></span>
</span>
</button>
<header class=site-info>
<figure class=site-avatar>
<img src=/images/avatar.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</figure>
<h1 class=site-name><a href=https://bmhstsa.com/>BMHS TSA</a></h1>
<h2 class=site-description>Battle Mountain High School Technology Student Association</h2>
</header>
<ol class=menu id=main-menu>
<li>
<a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span>
</a>
</li>
<li>
<a href=/about/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About</span>
</a>
</li>
<li>
<a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span>
</a>
</li>
<li>
<a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span>
</a>
</li>
<li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span>
</li>
</ol>
</aside>
<main class="main full-width">
<div id=article-toolbar>
<a href=https://bmhstsa.com/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>Back</span>
</a>
</div>
<article class=main-article>
<header class=article-header>
<div class=article-details>
<header class=article-category>
<a href=/categories/picoctf/>
picoCTF
</a>
</header>
<h2 class=article-title>
<a href=/post/web-gauntlet-2/>Web Gauntlet 2</a>
</h2>
<h3 class=article-subtitle>
picoCTF writeup by Wakeful Cloud
</h3>
<footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--published>Mar 30, 2021</time>
</footer></div>
</header>
<section class=article-content>
<h3 id=challenge-rating>Challenge Rating</h3>
<ul>
<li>Artificialness: <code>3/10</code></li>
<li>Skill: <code>6/10</code></li>
<li>Time: <code>2-3 hours</code></li>
</ul>
<p><em>Learn more about how we rate challenges <a class=link href=/post/rating>here</a>.</em></p>
<h2 id=preface>Preface</h2>
<p>This is the followup challenge to <a class=link href=https://play.picoctf.org/practice/challenge/88 target=_blank rel=noopener>Web Gauntlet</a>.</p>
<h2 id=what-are-sql-injections>What are SQL injections?</h2>
<p>SQL injections occur when a server improperly handles user input in such a
way that the user can write SQL queries and run them on the server. For example,
lets say we&rsquo;re running a simple web server that performs a username/password
lookup:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=k>SELECT</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>username</span><span class=o>=</span><span class=s1>&#39;[USERNAME INPUT]&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>password</span><span class=o>=</span><span class=s1>&#39;[PASSWORD INPUT]&#39;</span><span class=p>;</span><span class=w>
</span></code></pre></div><p>Even if you don&rsquo;t know SQL, you can probably figure out that we&rsquo;re querying the
database for users with a <code>username</code> equal to <code>[USERNAME INPUT]</code> and a <code>password</code>
equal to <code>[PASSWORD INPUT]</code>. Well, say an attacker were to enter <code>'</code>. Just a
single-quote. What do you think would happen? If the server was programmed
correctly, it would escape the quote or filter it out resulting in the following
query:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=k>SELECT</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>username</span><span class=o>=</span><span class=s1>&#39;&#39;&#39;&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>password</span><span class=o>=</span><span class=s1>&#39;[PASSWORD INPUT]&#39;</span><span class=p>;</span><span class=w>
</span></code></pre></div><p><em>Note: you escape single-quotes by doubling them up in SQLite.</em></p>
<p>But if the server simply concatenates or adds strings together to form a query
such as with the below pseudocode:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=s2>&#34;SELECT username, password FROM users WHERE username=&#39;&#34;</span> <span class=o>+</span> <span class=nx>username</span> <span class=o>+</span> <span class=s2>&#34;&#39; AND password=&#39;&#34;</span> <span class=o>+</span> <span class=nx>password</span> <span class=o>+</span> <span class=s2>&#34;&#39;;&#34;</span>
</code></pre></div><p>This would produce the following query:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=k>SELECT</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>username</span><span class=o>=</span><span class=s1>&#39;&#39;&#39; AND password=&#39;</span><span class=p>[</span><span class=n>PASSWORD</span><span class=w> </span><span class=k>INPUT</span><span class=p>]</span><span class=s1>&#39;;
</span></code></pre></div><p><em>Note: this is actually an invalid query but bare with me.</em></p>
<p>Notice how the syntax highlighting is different than when the server properly
escapes the single-quote? That&rsquo;s because we now have a single string starting
with an escaped quote (<code>'' AND password=</code>). This is called an injection
vulnerability because a crafty attacker could format the username or password
in such a way that when the server concatenates the user-input together, it
generates a totally different, malicious query.</p>
<h2 id=solving-the-challenge>Solving the challenge</h2>
<p>One important thing to note about this challenge is that our user-input cannot
contain any of the following <code>or and true false union like = > &lt; ; -- /* */ admin</code>
(Which can be found on the <code>filter.php</code> page).</p>
<h3 id=setting-the-username>Setting the username</h3>
<p>So first we need to figure out how to query the <code>admin</code> user without actually
typing <code>admin</code> (Because it&rsquo;s filtered). Luckily, SQLite (The flavor of SQL this
challenge uses) supports <a class=link href=https://www.techonthenet.com/sqlite/functions/concatenate.php target=_blank rel=noopener>string concatenation</a>
(<em>Adding</em> two or more strings together). So now we can type <code>admin</code> with the
following for the <code>username</code>: <code>admi'||'n</code> which will turn into:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=k>SELECT</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>username</span><span class=o>=</span><span class=s1>&#39;admi&#39;</span><span class=o>||</span><span class=s1>&#39;n&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>password</span><span class=o>=</span><span class=s1>&#39;[PASSWORD INPUT]&#39;</span><span class=p>;</span><span class=w>
</span></code></pre></div><p>Sweet!</p>
<h3 id=setting-the-password>Setting the password</h3>
<p>We don&rsquo;t know the password and this challenge isn&rsquo;t about getting the password,
so we need to get more creative - think about ways of removing the <code>AND</code> part
of the query.</p>
<p>Remember how earlier when the attacker entered a single-quote (<code>'</code>) it
generated an invalid SQL query because the string kind of <em>bridged</em> the 2 user
inputs? Well if we do something with that string, then that eliminates the
<code>password=</code> part of the query meaning we don&rsquo;t have to guess or crack the
password.</p>
<p>My solution is far from elegant but I decided to kill 2 birds with one stone by using the length of the <em>bridged</em> string using the <a class=link href=https://www.w3resource.com/sqlite/core-functions-length.php target=_blank rel=noopener>SQLite <code>LENGTH</code> function</a>
in combination with the <a class=link href=https://www.w3resource.com/sqlite/core-functions-char.php target=_blank rel=noopener>SQLite <code>CHAR</code> function</a>
to generate the <code>n</code> in <code>admin</code> via <a class=link href=https://en.wikipedia.org/wiki/ASCII target=_blank rel=noopener>character codes</a>.</p>
<p>In essence, the <em>bridged</em> string is <code> AND password=</code> (14 characters long) and
the ASCII character code for <code>n</code> is 110. So then I multiplied 14 by 110 which
is 1540. Finally I concatenated an empty string at the end to make sure there
wasn&rsquo;t an unmatched single-quote. When the server executes the query, it will
undo the multiplication and return the correct character code. I know this
sounds confusing but it&rsquo;s somewhat simple when you see it written out:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=k>SELECT</span><span class=w> </span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>password</span><span class=w> </span><span class=k>FROM</span><span class=w> </span><span class=n>users</span><span class=w> </span><span class=k>WHERE</span><span class=w> </span><span class=n>username</span><span class=o>=</span><span class=s1>&#39;admi&#39;</span><span class=o>||</span><span class=nb>CHAR</span><span class=p>(</span><span class=mi>1540</span><span class=o>/</span><span class=k>LENGTH</span><span class=p>(</span><span class=s1>&#39; AND password=&#39;</span><span class=p>))</span><span class=o>||</span><span class=s1>&#39;&#39;</span><span class=p>;</span><span class=w>
</span></code></pre></div><p>So if you set the <code>username</code> to <code>admi'||CHAR(1540/LENGTH(</code> and the password to
<code>))||'</code>, you should see the flag on <code>filter.php</code>. Again, not the most elegant
solution. If you want to see a more elegant solution, check out the sequel to
this challenge, <a class=link href=/post/web-gauntlet-3>Web Gauntlet 3</a>.</p>
</section>
<footer class=article-footer>
<section class=article-tags>
<a href=/tags/web-exploitation/>Web Exploitation</a>
<a href=/tags/injection-vulnerability/>Injection Vulnerability</a>
<a href=/tags/wakeful-cloud/>Wakeful Cloud</a>
</section>
<section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span>
</section>
</footer>
</article>
<aside class=related-contents--wrapper>
<h2 class=section-title>Related contents</h2>
<div class=related-contents>
<div class="flex article-list--tile">
<article>
<a href=/post/x-marks-the-spot/>
<div class=article-details>
<h2 class=article-title>X Marks the Spot</h2>
</div>
</a>
</article>
<article>
<a href=/post/web-gauntlet-3/>
<div class=article-details>
<h2 class=article-title>Web Gauntlet 3</h2>
</div>
</a>
</article>
<article>
<a href=/post/get-ahead/>
<div class=article-details>
<h2 class=article-title>Get Ahead</h2>
</div>
</a>
</article>
<article>
<a href=/post/wireshark-2/>
<div class=article-details>
<h2 class=article-title>Wireshark 2</h2>
</div>
</a>
</article>
<article>
<a href=/post/crackme-py/>
<div class=article-details>
<h2 class=article-title>crackme-py</h2>
</div>
</a>
</article>
</div>
</div>
</aside>
<footer class=site-footer>
<section class=copyright>
&copy;
2020 -
2022 BMHS TSA
</section>
<section class=powerby>
Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> <br>
Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=2.3.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>
</section>
</footer>
<div class=pswp tabindex=-1 role=dialog aria-hidden=true>
<div class=pswp__bg></div>
<div class=pswp__scroll-wrap>
<div class=pswp__container>
<div class=pswp__item></div>
<div class=pswp__item></div>
<div class=pswp__item></div>
</div>
<div class="pswp__ui pswp__ui--hidden">
<div class=pswp__top-bar>
<div class=pswp__counter></div>
<button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
<div class=pswp__preloader>
<div class=pswp__preloader__icn>
<div class=pswp__preloader__cut>
<div class=pswp__preloader__donut></div>
</div>
</div>
</div>
</div>
<div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
<div class=pswp__share-tooltip></div>
</div>
<button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
</button>
<div class=pswp__caption>
<div class=pswp__caption__center></div>
</div>
</div>
</div>
</div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous>
</main>
</div>
<script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous defer></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const a=document.createElement('link');a.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",a.type="text/css",a.rel="stylesheet",document.head.appendChild(a)})()</script>
</body>
</html>